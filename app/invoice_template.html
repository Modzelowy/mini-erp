<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: 'DejaVu';
            src: url('assets/DejaVuSans.ttf');
        }
        body { font-family: 'DejaVu', sans-serif; font-size: 10pt; color: #333; }
        .invoice-box { max-width: 800px; margin: auto; padding: 30px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0, 0, 0, .15); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #333; margin: 0; }
        .details-table { width: 100%; line-height: inherit; text-align: left; }
        .details-table td { padding: 5px; vertical-align: top; }
        .details-table .right { text-align: right; }
        .seller-buyer .title { font-weight: bold; color: #555; }
        .items-table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; margin-top: 20px;}
        .items-table th { background: #eee; border: 1px solid #ddd; padding: 6px; font-weight: bold; text-align: center; }
        .items-table td { padding: 6px; border: 1px solid #ddd; }
        .items-table .center { text-align: center; }
        .items-table .right { text-align: right; }
        .summary-table { width: 40%; margin-top: 20px; float: right; border-collapse: collapse; }
        .summary-table td { padding: 6px; border: 1px solid #ddd; }
        .summary-table .label { font-weight: bold; }
        .summary-table .value { text-align: right; }
        .total-in-words { margin-top: 30px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="invoice-box">
        <div class="header">
            <h1>Faktura VAT nr {{ order.invoice_number }}</h1>
        </div>
        <table class="details-table">
            <tr>
                <td><strong>Data wystawienia:</strong> {{ order.order_date.strftime('%Y-%m-%d') }}</td>
                <td class="right"><strong>Termin płatności:</strong> {{ order.payment_due_date.strftime('%Y-%m-%d') }}</td>
            </tr>
        </table>
        <hr>
        <table class="details-table seller-buyer">
            <tr>
                <td class="title" style="width:50%;">Sprzedawca:</td>
                <td class="title" style="width:50%;">Nabywca:</td>
            </tr>
            <tr>
                <td>
                    {{ company.company_name }}<br>
                    {{ company.address_street }}<br>
                    {{ company.address_zipcode }} {{ company.address_city }}<br>
                    NIP: {{ company.vat_id }}
                </td>
                <td>
                    {{ order.client.display_name }}<br>
                    {{ order.client.address_street }}<br>
                    {{ order.client.address_zipcode }} {{ order.client.address_city }}<br>
                    NIP: {{ order.client.vat_id or '---' }}
                </td>
            </tr>
        </table>
        <table class="items-table">
            <thead>
                <tr>
                    <th>Lp.</th>
                    <th style="width:40%;">Nazwa towaru</th>
                    <th>J.m.</th>
                    <th>Ilość</th>
                    <th>Cena netto</th>
                    <th>VAT</th>
                    <th>Wartość netto</th>
                    <th>Wartość brutto</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                <tr>
                    <td class="center">{{ loop.index }}</td>
                    <td>{{ item.product.name }}</td>
                    <td class="center">{{ item.product.unit.value }}</td>
                    <td class="center">{{ item.quantity }}</td>
                    <td class="right">{{ "%.2f"|format(item.price_per_unit) }} PLN</td>
                    <td class="center">{{ "%.0f"|format(item.vat_rate) }}%</td>
                    <td class="right">{{ "%.2f"|format(item.quantity * item.price_per_unit) }} PLN</td>
                    <td class="right">{{ "%.2f"|format(item.quantity * item.price_per_unit * (1 + item.vat_rate / 100)) }} PLN</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <table class="summary-table">
            <tr><td class="label">Suma netto:</td><td class="value">{{ "%.2f"|format(summary.total_net) }} PLN</td></tr>
            <tr><td class="label">Suma VAT:</td><td class="value">{{ "%.2f"|format(summary.total_vat) }} PLN</td></tr>
            <tr><td class="label">Do zapłaty (brutto):</td><td class="value">{{ "%.2f"|format(summary.total_gross) }} PLN</td></tr>
        </table>
        <div style="clear: both;"></div>
        <div class="total-in-words">
            <strong>Słownie:</strong> {{ summary.total_in_words }}
        </div>
    </div>
</body>
</html>
